version: 2

semantic_models:
  - name: orders_semantic_model
    description: "order-level facts for ecommerce analytics."
    model: ref('fct_orders')

    defaults:
      agg_time_dimension: order_date

    entities:
      - name: order
        type: primary
        expr: ORDER_ID

      - name: customer
        type: foreign
        expr: CUSTOMER_ID

    measures:
      - name: order_revenue
        description: "total revenue from orders."
        agg: sum
        expr: ORDER_REVENUE
        create_metric: true

      - name: order_count
        description: "count of distinct orders."
        agg: count_distinct
        expr: ORDER_ID
        create_metric: true

      - name: items_sold
        description: "total quantity of items sold."
        agg: sum
        expr: TOTAL_ITEMS
        create_metric: true

    dimensions:
      - name: order_date
        description: "date of order."
        type: time
        expr: ORDER_DATE
        type_params:
          time_granularity: day

      - name: order_status
        description: "status of the order."
        type: categorical
        expr: ORDER_STATUS

      - name: payment_method
        description: "payment method used for the order."
        type: categorical
        expr: PAYMENT_METHOD

  - name: customers_semantic_model
    description: "customer dimension for ecommerce analytics."
    model: ref('dim_customers')

    entities:
      - name: customer
        type: primary
        expr: CUSTOMER_ID

    dimensions:
      - name: customer_id
        description: "primary key for customer."
        type: categorical
        expr: CUSTOMER_ID

      - name: customer_name
        description: "name of the customer."
        type: categorical
        expr: CUSTOMER_NAME

      - name: email
        description: "email address of the customer."
        type: categorical
        expr: EMAIL

      - name: country
        description: "country of the customer."
        type: categorical
        expr: COUNTRY

      - name: customer_created_at
        description: "timestamp when the customer was created."
        type: time
        expr: CUSTOMER_CREATED_AT
        type_params:
          time_granularity: day

metrics:
  - name: total_revenue
    description: "total order revenue across all orders."
    type: simple
    label: "TOTAL REVENUE"
    type_params:
      measure: order_revenue

  - name: total_orders
    description: "total number of distinct orders."
    type: simple
    label: "TOTAL ORDERS"
    type_params:
      measure: order_count

  - name: total_items_sold
    description: "total quantity of items sold across orders."
    type: simple
    label: "TOTAL ITEMS SOLD"
    type_params:
      measure: items_sold